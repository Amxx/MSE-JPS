var MSE_JPS=MSE_JPS||{};MSE_JPS.client=MSE_JPS.client||{};(function(){this.hashHandler=function(a){var d=window.location.hash.substring(1);if(d==""){d=MSE_JPS.client.id2hash(MSE_JPS.client.getCurrentId())}try{var e=MSE_JPS.client.hash2id(d);MSE_JPS.client.showPage(e,a);MSE_JPS.client.updateTitle(MSE_JPS.client.id2hash(e))}catch(c){var b=404;if(new RegExp("[0-9]{3}error").test(d)){b=parseInt(d.substring(0,3))}MSE_JPS.client.showError(b);MSE_JPS.client.updateTitle(MSE_JPS.client.errorText(b))}};this.getCurrentId=function(){return parseInt($("section").filter(function(){return $(this).css("display")!="none"}).attr("id").substring(8))};this.id2hash=function(a){return $("#nav-a-"+a).text()};this.hash2id=function(a){return parseInt($("#nav").find("a").filter(function(){return $(this).text()==a}).attr("id").substring(6))};this.showPage=function(c,a){var b=MSE_JPS.client.getCurrentId();if(c!=b){if(a){$("#section-"+b).slideUp("slow");$("#section-"+c).slideDown("slow",function(){$("#section-"+c).packery()})}else{$("#section-"+c).show();$("#section-"+b).hide()}$("#section-"+c).show();$("#nav-li-"+c).addClass("current");$("#nav-li-"+b).removeClass()}};this.showError=function(a){MSE_JPS.popup.info(MSE_JPS.client.errorText(a),function(){window.location.hash=MSE_JPS.client.id2hash(MSE_JPS.client.getCurrentId())})};this.updateTitle=function(a){document.title=$("#name").text()+" | "+a};this.slideTop=function(){$("html, body").animate({scrollTop:0},"120")};this.retile=function(a){if(a){a.closest("section").packery()}else{$("section").packery()}};this.toggleBlock=function(a){var b=$(a).closest(".block");if(b.siblings().size()){b.toggleClass("expanded");MSE_JPS.client.retile($(a))}else{b.find(".content").slideToggle()}};this.toggleBib=function(a){$(a).closest(".bibentry").find(".bibtray").toggle();MSE_JPS.client.retile($(a))};this.errorText=function(a){switch(a){case 400:return"400 Bad Request";case 401:return"401 Unauthorized";case 403:return"403 Forbidden";case 404:return"404 Not Found";case 502:return"502 Bad Gateway";default:return"Undocumented error ("+a+")"}};this.buildNav=function(){$("#nav, #mininav").find("a").filter(function(){return $(this).attr("id")}).each(function(){$(this).attr("href","#");$(this).click(function(){window.location.hash=$(this).text();return false})})}}).apply(MSE_JPS.client);$(window).bind("hashchange",function(){MSE_JPS.client.hashHandler(true)});$(function(){MSE_JPS.client.buildNav();MSE_JPS.client.hashHandler(false)});var MSE_JPS=MSE_JPS||{};MSE_JPS.popup=MSE_JPS.popup||{};(function(){this.open=function(){var a=$("<dialog/>").addClass("popup").appendTo("body");dialogPolyfill.registerDialog(a[0]);a[0].showModal();return a};this.close=function(a){a[0].close();a.remove()};this.input=function(c,d,a){var b=MSE_JPS.popup.open();b.append($("<h4/>").text(c)).append($("<input/>").attr("type","text").attr("placeholder",a));b.find("input").keyup(function(e){switch(e.which){case 13:MSE_JPS.popup.close(b);if(d){d(this.value)}break;case 27:MSE_JPS.popup.close(b);break}}).blur(function(){MSE_JPS.popup.close(b)}).focus()};this.confirm=function(b,c){var a=MSE_JPS.popup.open();a.append($("<h4/>").text(b)).append($("<a/>").addClass("button").text("No")).append($("<a/>").addClass("button").text("Yes"));a.find("a.button").each(function(){$(this).click(function(){MSE_JPS.popup.close(a);if(c){c($(this).text()=="Yes")}})})};this.info=function(b,c){var a=MSE_JPS.popup.open();a.css("cursor","pointer").append($("<h4/>").text(b)).click(function(){MSE_JPS.popup.close(a);if(c){c()}})}}).apply(MSE_JPS.popup);